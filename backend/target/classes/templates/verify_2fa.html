<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify 2FA</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body
    style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #F2F2F7; margin: 0;">
    <div class="card" style="width: 320px; padding: 30px; text-align: center;">
        <h2 style="margin-bottom: 20px;">Admin Verification</h2>
        <p style="color: #8E8E93; margin-bottom: 20px;">Enter the 6-digit code from your authenticator app.</p>

        <input type="text" id="code" placeholder="000 000" maxlength="6"
            style="width: 100%; padding: 12px; border: 1px solid #E5E5EA; border-radius: 12px; margin-bottom: 20px; font-size: 24px; text-align: center; letter-spacing: 4px;">

        <button onclick="verify()"
            style="width: 100%; padding: 14px; background: #007AFF; color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer;">Verify</button>
    </div>

    <script>
        async function verify() {
            const code = document.getElementById('code').value;
            const email = localStorage.getItem('pending_email'); // Saved during login step

            if (!code || !email) return alert('Missing info');

            const response = await fetch('/api/auth/verify-2fa', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, code })
            });

            if (response.ok) {
                const data = await response.json();
                localStorage.setItem('token', data.jwt);
                window.location.href = '/admin/dashboard';
            } else {
                alert('Invalid Code');
            }
        }
    </script>
</body>

</html>