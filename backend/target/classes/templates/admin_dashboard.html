<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
    <script>
        // Check Auth
        if (!localStorage.getItem('token')) window.location.href = '/';
    </script>
</head>

<body
    style="background: #F2F2F7; padding: 40px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">
    <div style="max-width: 800px; margin: 0 auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1 style="font-size: 32px; font-weight: 700;">Admin Dashboard</h1>
            <button onclick="logout()"
                style="background: white; color: #FF3B30; padding: 8px 16px; border-radius: 12px; border: none; font-weight: 600; cursor: pointer;">Logout</button>
        </div>

        <!-- Pending Technicians -->
        <div class="card" style="padding: 24px; background: white; border-radius: 20px;">
            <h2 style="font-size: 20px; margin-bottom: 20px;">Pending Technicians</h2>
            <div id="techList">
                <p style="color: #8E8E93;">Loading...</p>
            </div>
        </div>
    </div>

    <script>
        async function loadData() {
            const token = localStorage.getItem('token');
            const response = await fetch('/api/admin/pending-technicians', {
                headers: { 'Authorization': 'Bearer ' + token }
            });

            if (response.ok) {
                const users = await response.json();
                const list = document.getElementById('techList');
                list.innerHTML = users.length ? '' : '<p>No pending approvals.</p>';

                users.forEach(user => {
                    const item = document.createElement('div');
                    item.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid #E5E5EA;';
                    item.innerHTML = `
                        <div>
                            <div style="font-weight: 600;">${user.name}</div>
                            <div style="color: #8E8E93; font-size: 14px;">${user.email}</div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            ${user.idDocumentPath ? `<a href="/api/admin/download-id/${user.id}" target="_blank" style="padding: 8px 12px; background: #E5E5EA; color: #007AFF; text-decoration: none; border-radius: 8px; font-size: 14px;">View ID PDF</a>` : ''}
                            <button onclick="approve(${user.id})" style="padding: 8px 16px; background: #34C759; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Approve</button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            } else {
                alert('Failed to load data. Are you Admin?');
            }
        }

        async function approve(id) {
            const token = localStorage.getItem('token');
            await fetch('/api/admin/approve-technician/' + id, {
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token }
            });
            loadData();
        }

        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/';
        }

        loadData();
    </script>
</body>

</html>